<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
            background: #2a2a2a;
        }
        .result {
            background: #333;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .error { background: #4a1a1a; color: #ff6b6b; }
        .success { background: #1a4a1a; color: #6bff6b; }
        .loading { background: #1a1a4a; color: #6b6bff; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        .chart-container {
            width: 100%;
            height: 400px;
            border: 1px solid #555;
            margin: 20px 0;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            margin: 5px;
            font-size: 12px;
        }
        .status.success { background: #4caf50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.loading { background: #2196f3; color: white; }
    </style>
</head>
<body>
    <h1>üîß Chart Debug Tool</h1>
    
    <div class="test-section">
        <h3>Test 1: Lightweight Charts Library</h3>
        <button onclick="testLightweightCharts()">Test Lightweight Charts</button>
        <div id="lightweight-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Test 2: Chart Container</h3>
        <button onclick="testChartContainer()">Test Chart Container</button>
        <div id="container-result" class="result"></div>
        <div id="chart-container" class="chart-container"></div>
    </div>

    <div class="test-section">
        <h3>Test 3: Mock Data</h3>
        <button onclick="testMockData()">Test Mock Data</button>
        <div id="mock-data-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Test 4: Chart Creation</h3>
        <button onclick="testChartCreation()">Test Chart Creation</button>
        <div id="chart-creation-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Test 5: Data Rendering</h3>
        <button onclick="testDataRendering()">Test Data Rendering</button>
        <div id="data-rendering-result" class="result"></div>
    </div>

    <script type="module">
        let chartInstance = null;
        let seriesInstance = null;

        window.testLightweightCharts = async function() {
            const resultDiv = document.getElementById('lightweight-result');
            resultDiv.textContent = 'Testing Lightweight Charts library...';
            resultDiv.className = 'result loading';

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
                if (typeof createChart === 'undefined') {
                    resultDiv.textContent = '‚ùå Lightweight Charts library not loaded';
                    resultDiv.className = 'result error';
                    return;
                }

                resultDiv.textContent = '‚úÖ Lightweight Charts library is available\n' +
                    'createChart function: ' + typeof createChart + '\n' +
                    'IChartApi: ' + (typeof IChartApi !== 'undefined' ? 'available' : 'not available') + '\n' +
                    'ISeriesApi: ' + (typeof ISeriesApi !== 'undefined' ? 'available' : 'not available');
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = '‚ùå Error testing Lightweight Charts: ' + error.message;
                resultDiv.className = 'result error';
            }
        };

        window.testChartContainer = function() {
            const resultDiv = document.getElementById('container-result');
            const container = document.getElementById('chart-container');
            
            resultDiv.textContent = 'Testing chart container...';
            resultDiv.className = 'result loading';

            try {
                const rect = container.getBoundingClientRect();
                const styles = window.getComputedStyle(container);
                
                resultDiv.textContent = '‚úÖ Chart container details:\n' +
                    'Element: ' + container.tagName + '\n' +
                    'Width: ' + rect.width + 'px\n' +
                    'Height: ' + rect.height + 'px\n' +
                    'Display: ' + styles.display + '\n' +
                    'Position: ' + styles.position + '\n' +
                    'Visibility: ' + styles.visibility + '\n' +
                    'Opacity: ' + styles.opacity;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = '‚ùå Error testing container: ' + error.message;
                resultDiv.className = 'result error';
            }
        };

        window.testMockData = function() {
            const resultDiv = document.getElementById('mock-data-result');
            resultDiv.textContent = 'Creating mock data...';
            resultDiv.className = 'result loading';

            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const mockData = [];
                const now = Date.now();
                
                for (let i = 0; i < 100; i++) {
                    const time = now - (100 - i) * 24 * 60 * 60 * 1000; // 100 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
                    const basePrice = 50000 + Math.random() * 10000;
                    const volatility = 0.02;
                    
                    mockData.push({
                        time: Math.floor(time / 1000), // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                        open: basePrice * (1 + (Math.random() - 0.5) * volatility),
                        high: basePrice * (1 + Math.random() * volatility),
                        low: basePrice * (1 - Math.random() * volatility),
                        close: basePrice * (1 + (Math.random() - 0.5) * volatility)
                    });
                }

                resultDiv.textContent = '‚úÖ Mock data created:\n' +
                    'Data points: ' + mockData.length + '\n' +
                    'First data: ' + JSON.stringify(mockData[0], null, 2) + '\n' +
                    'Last data: ' + JSON.stringify(mockData[mockData.length - 1], null, 2);
                resultDiv.className = 'result success';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
                window.mockData = mockData;
            } catch (error) {
                resultDiv.textContent = '‚ùå Error creating mock data: ' + error.message;
                resultDiv.className = 'result error';
            }
        };

        window.testChartCreation = function() {
            const resultDiv = document.getElementById('chart-creation-result');
            const container = document.getElementById('chart-container');
            
            resultDiv.textContent = 'Creating chart instance...';
            resultDiv.className = 'result loading';

            try {
                if (typeof createChart === 'undefined') {
                    resultDiv.textContent = '‚ùå createChart function not available';
                    resultDiv.className = 'result error';
                    return;
                }

                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.innerHTML = '';

                // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                chartInstance = createChart(container, {
                    width: container.clientWidth,
                    height: container.clientHeight,
                    layout: {
                        background: { color: '#1a1a1a' },
                        textColor: '#d1d5db'
                    },
                    grid: {
                        vertLines: { color: '#2d2d2d' },
                        horzLines: { color: '#2d2d2d' }
                    },
                    crosshair: {
                        mode: 1,
                        vertLine: {
                            color: '#f7931a',
                            width: 1,
                            style: 3,
                            labelBackgroundColor: '#f7931a'
                        },
                        horzLine: {
                            color: '#f7931a',
                            width: 1,
                            style: 3,
                            labelBackgroundColor: '#f7931a'
                        }
                    },
                    rightPriceScale: {
                        borderColor: '#2d2d2d',
                        scaleMargins: {
                            top: 0.1,
                            bottom: 0.1
                        }
                    },
                    timeScale: {
                        borderColor: '#2d2d2d',
                        timeVisible: true,
                        secondsVisible: false
                    }
                });

                // –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–∏—é —Å–≤–µ—á–µ–π
                seriesInstance = chartInstance.addCandlestickSeries({
                    upColor: '#10b981',
                    downColor: '#ef4444',
                    borderDownColor: '#ef4444',
                    borderUpColor: '#10b981',
                    wickDownColor: '#ef4444',
                    wickUpColor: '#10b981'
                });

                resultDiv.textContent = '‚úÖ Chart created successfully:\n' +
                    'Chart instance: ' + (chartInstance ? 'created' : 'failed') + '\n' +
                    'Series instance: ' + (seriesInstance ? 'created' : 'failed') + '\n' +
                    'Container width: ' + container.clientWidth + 'px\n' +
                    'Container height: ' + container.clientHeight + 'px';
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = '‚ùå Error creating chart: ' + error.message + '\n' + error.stack;
                resultDiv.className = 'result error';
            }
        };

        window.testDataRendering = function() {
            const resultDiv = document.getElementById('data-rendering-result');
            
            resultDiv.textContent = 'Rendering data to chart...';
            resultDiv.className = 'result loading';

            try {
                if (!chartInstance || !seriesInstance) {
                    resultDiv.textContent = '‚ùå Chart or series not created. Run chart creation test first.';
                    resultDiv.className = 'result error';
                    return;
                }

                if (!window.mockData) {
                    resultDiv.textContent = '‚ùå Mock data not available. Run mock data test first.';
                    resultDiv.className = 'result error';
                    return;
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                seriesInstance.setData(window.mockData);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
                if (window.mockData.length > 0) {
                    const lastIndex = window.mockData.length - 1;
                    const startIndex = Math.max(0, lastIndex - 50);
                    chartInstance.timeScale().setVisibleRange({
                        from: window.mockData[startIndex].time,
                        to: window.mockData[lastIndex].time,
                    });
                }

                resultDiv.textContent = '‚úÖ Data rendered successfully:\n' +
                    'Data points set: ' + window.mockData.length + '\n' +
                    'Time range: ' + window.mockData[0].time + ' to ' + window.mockData[window.mockData.length - 1].time + '\n' +
                    'Chart should now display candlesticks';
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = '‚ùå Error rendering data: ' + error.message + '\n' + error.stack;
                resultDiv.className = 'result error';
            }
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setTimeout(() => {
                testLightweightCharts();
            }, 100);
        };
    </script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</body>
</html> 